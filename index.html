<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annotix - Image Annotation Tool</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body x-data x-init="$store.app.init()">

    <!-- Loading Overlay -->
    <div x-show="$store.app.isLoading"
         class="loading-overlay"
         x-transition>
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Toast Notifications -->
    <div x-show="$store.app.toast.visible"
         x-transition
         class="toast"
         :class="`toast-${$store.app.toast.type}`">
        <i class="fas"
           :class="{
               'fa-check-circle': $store.app.toast.type === 'success',
               'fa-exclamation-circle': $store.app.toast.type === 'error',
               'fa-info-circle': $store.app.toast.type === 'info'
           }"></i>
        <span x-text="$store.app.toast.message"></span>
    </div>

    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="header-content">

                <!-- Left: Logo & Title -->
                <div class="header-left">
                    <a href="https://www.uach.cl" target="_blank" class="header-logo-link">
                        <img src="https://www.uach.cl/uach/_imag/uach/logo-v2.png"
                             alt="Universidad Austral de Chile"
                             class="header-logo">
                    </a>
                    <div class="header-divider-vertical"></div>
                    <h1 class="app-title">
                        <i class="fas fa-tag"></i>
                        <span>Annotix</span>
                    </h1>
                </div>

                <!-- Center: Project Controls -->
                <div class="header-center">

                    <!-- Project Selector -->
                    <select x-model="$store.app.currentProjectId"
                            @change="$store.app.loadProject(parseInt($event.target.value))"
                            class="project-selector">
                        <option value="">Select project...</option>
                        <template x-for="project in $store.app.projects" :key="project.id">
                            <option :value="project.id" x-text="project.name"></option>
                        </template>
                    </select>

                    <!-- New Project -->
                    <button class="btn-header btn-icon-only"
                            @click="$store.app.showModal('newProject')"
                            title="New Project">
                        <i class="fas fa-plus"></i>
                    </button>

                    <!-- Manage Projects -->
                    <button class="btn-header btn-icon-only"
                            @click="$store.app.showModal('manageProjects')"
                            title="Manage Projects">
                        <i class="fas fa-folder-tree"></i>
                    </button>

                    <div class="header-divider"></div>

                    <!-- Save -->
                    <button class="btn-header btn-icon-only"
                            @click="$store.app.saveCurrentImage()"
                            :disabled="!$store.app.hasUnsavedChanges"
                            title="Save (Ctrl+S)">
                        <i class="fas fa-save"></i>
                        <span x-show="$store.app.hasUnsavedChanges"
                              class="unsaved-indicator"></span>
                    </button>

                    <!-- Export -->
                    <button class="btn-header btn-icon-only"
                            @click="$store.app.showModal('export')"
                            :disabled="!$store.app.hasProject"
                            title="Export Dataset">
                        <i class="fas fa-download"></i>
                    </button>
                </div>

                <!-- Right: Help & Language -->
                <div class="header-right">
                    <button class="btn-header btn-icon-ghost"
                            @click="$dispatch('show-help')"
                            title="Help">
                        <i class="fas fa-question-circle"></i>
                    </button>

                    <button class="btn-header btn-icon-ghost"
                            @click="$dispatch('show-shortcuts')"
                            title="Keyboard Shortcuts">
                        <i class="fas fa-keyboard"></i>
                    </button>

                    <div class="header-divider"></div>

                    <!-- Language Selector -->
                    <select x-data="{ lang: localStorage.getItem('language') || 'es' }"
                            x-model="lang"
                            @change="$dispatch('change-language', lang)"
                            class="language-selector">
                        <option value="en">üá¨üáß English</option>
                        <option value="es">üá™üá∏ Espa√±ol</option>
                        <option value="fr">üá´üá∑ Fran√ßais</option>
                        <option value="de">üá©üá™ Deutsch</option>
                        <option value="pt">üáµüáπ Portugu√™s</option>
                        <option value="it">üáÆüáπ Italiano</option>
                        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                        <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                        <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                    </select>

                    <a href="https://github.com/debaq/Annotix"
                       target="_blank"
                       class="btn-header btn-icon-ghost"
                       title="GitHub">
                        <i class="fab fa-github"></i>
                    </a>
                </div>

            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">

            <!-- Sidebar -->
            <aside class="sidebar" x-show="$store.app.hasProject">

                <!-- Classes Section -->
                <div class="sidebar-section">
                    <div class="section-header">
                        <h3><i class="fas fa-tags"></i> Classes</h3>
                        <button class="btn-icon-sm"
                                @click="$dispatch('add-class')"
                                title="Add Class">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <div class="classes-list">
                        <template x-for="(cls, index) in $store.app.currentProject?.classes" :key="index">
                            <div class="class-item"
                                 :class="{ 'active': $store.app.selectedClass === index }"
                                 @click="$store.app.selectedClass = index">
                                <div class="class-color"
                                     :style="`background: ${cls.color}`"></div>
                                <span class="class-name" x-text="cls.name"></span>
                                <span class="class-shortcut" x-text="index + 1"></span>
                            </div>
                        </template>

                        <div x-show="!$store.app.currentProject?.classes?.length"
                             class="empty-state">
                            No classes defined
                        </div>
                    </div>
                </div>

                <!-- Tools Section -->
                <div class="sidebar-section" x-show="$store.app.currentProject">
                    <div class="section-header">
                        <h3><i class="fas fa-tools"></i> Tools</h3>
                    </div>

                    <div class="tools-grid">
                        <!-- Show tools based on project type -->
                        <template x-if="$store.app.currentProject?.type === 'bbox'">
                            <div class="tool-buttons">
                                <button class="tool-btn"
                                        :class="{ 'active': $store.app.selectedTool === 'bbox' }"
                                        @click="$store.app.setTool('bbox')"
                                        title="Bounding Box (B)">
                                    <i class="fas fa-vector-square"></i>
                                    <span>Box</span>
                                </button>
                                <button class="tool-btn"
                                        :class="{ 'active': $store.app.selectedTool === 'select' }"
                                        @click="$store.app.setTool('select')"
                                        title="Select (V)">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <span>Select</span>
                                </button>
                                <button class="tool-btn"
                                        :class="{ 'active': $store.app.selectedTool === 'pan' }"
                                        @click="$store.app.setTool('pan')"
                                        title="Pan (H)">
                                    <i class="fas fa-hand"></i>
                                    <span>Pan</span>
                                </button>
                            </div>
                        </template>

                        <template x-if="$store.app.currentProject?.type === 'mask'">
                            <div class="tool-buttons">
                                <button class="tool-btn"
                                        :class="{ 'active': $store.app.selectedTool === 'mask' }"
                                        @click="$store.app.setTool('mask')"
                                        title="Mask (M)">
                                    <i class="fas fa-paintbrush"></i>
                                    <span>Mask</span>
                                </button>
                                <button class="tool-btn"
                                        :class="{ 'active': $store.app.selectedTool === 'erase' }"
                                        @click="$store.app.setTool('erase')"
                                        title="Erase">
                                    <i class="fas fa-eraser"></i>
                                    <span>Erase</span>
                                </button>
                                <button class="tool-btn"
                                        :class="{ 'active': $store.app.selectedTool === 'pan' }"
                                        @click="$store.app.setTool('pan')"
                                        title="Pan (H)">
                                    <i class="fas fa-hand"></i>
                                    <span>Pan</span>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Image Info -->
                <div class="sidebar-section" x-show="$store.app.hasImage">
                    <div class="section-header">
                        <h3><i class="fas fa-info-circle"></i> Image Info</h3>
                    </div>
                    <div class="image-info">
                        <div class="info-row">
                            <span class="label">Name:</span>
                            <span class="value" x-text="$store.app.currentImage?.name"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">Size:</span>
                            <span class="value"
                                  x-text="`${$store.app.currentImage?.width} √ó ${$store.app.currentImage?.height}`"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">Annotations:</span>
                            <span class="value"
                                  x-text="$store.app.currentImage?.annotations?.length || 0"></span>
                        </div>
                    </div>
                </div>

            </aside>

            <!-- Canvas Area -->
            <div class="canvas-area">

                <!-- Canvas Toolbar -->
                <div class="canvas-toolbar" x-show="$store.app.hasImage">

                    <!-- Zoom Controls -->
                    <div class="toolbar-group">
                        <button class="btn-toolbar"
                                @click="$store.app.setZoom($store.app.zoom - 0.1)"
                                title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <span class="zoom-value"
                              x-text="`${Math.round($store.app.zoom * 100)}%`"></span>
                        <button class="btn-toolbar"
                                @click="$store.app.setZoom($store.app.zoom + 0.1)"
                                title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="btn-toolbar"
                                @click="$store.app.setZoom(1)"
                                title="Reset Zoom">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Navigation -->
                    <div class="toolbar-group">
                        <button class="btn-toolbar"
                                @click="$store.app.previousImage()"
                                :disabled="!$store.app.canGoPrevious"
                                title="Previous Image (‚Üê)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="image-counter"
                              x-text="`${$store.app.currentImageIndex + 1} / ${$store.app.imageCount}`"></span>
                        <button class="btn-toolbar"
                                @click="$store.app.nextImage()"
                                :disabled="!$store.app.canGoNext"
                                title="Next Image (‚Üí)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Add Images -->
                    <button class="btn-toolbar"
                            @click="$refs.imageInput.click()"
                            title="Add Images">
                        <i class="fas fa-images"></i>
                        <span>Add Images</span>
                    </button>

                    <input type="file"
                           x-ref="imageInput"
                           multiple
                           accept="image/*"
                           @change="$store.app.addImages(Array.from($event.target.files))"
                           style="display: none;">

                </div>

                <!-- Canvas Container -->
                <div class="canvas-container"
                     x-show="$store.app.hasImage"
                     x-data="canvasComponent">
                    <canvas id="canvas"
                            x-ref="canvas"></canvas>
                </div>

                <!-- Empty State -->
                <div class="empty-state-canvas"
                     x-show="!$store.app.hasImage && $store.app.hasProject">
                    <i class="fas fa-images fa-4x"></i>
                    <h2>No Images</h2>
                    <p>Add images to start annotating</p>
                    <button class="btn-primary"
                            @click="$refs.imageInput.click()">
                        <i class="fas fa-plus"></i>
                        Add Images
                    </button>
                </div>

                <!-- No Project State -->
                <div class="empty-state-canvas"
                     x-show="!$store.app.hasProject">
                    <i class="fas fa-folder-open fa-4x"></i>
                    <h2>No Project Selected</h2>
                    <p>Create or select a project to begin</p>
                    <button class="btn-primary"
                            @click="$dispatch('show-new-project-modal')">
                        <i class="fas fa-plus"></i>
                        New Project
                    </button>
                </div>

            </div>

            <!-- Gallery Panel -->
            <aside class="gallery-panel" x-show="$store.app.hasProject">
                <div class="panel-header">
                    <h3><i class="fas fa-th"></i> Gallery</h3>
                    <span class="badge"
                          x-text="`${$store.app.annotatedImageCount} / ${$store.app.imageCount}`"></span>
                </div>

                <div class="gallery-grid">
                    <template x-for="image in $store.app.images" :key="image.id">
                        <div class="gallery-item"
                             :class="{ 'active': image.id === $store.app.currentImageId }"
                             @click="$store.app.loadImage(image.id)">
                            <div class="gallery-thumbnail">
                                <!-- Thumbnail will be generated dynamically -->
                                <span x-text="image.name"></span>
                            </div>
                            <div class="gallery-info">
                                <span class="image-name"
                                      x-text="image.name"
                                      :title="image.name"></span>
                                <span class="annotation-count"
                                      x-show="image.annotations?.length">
                                    <i class="fas fa-tag"></i>
                                    <span x-text="image.annotations.length"></span>
                                </span>
                            </div>
                        </div>
                    </template>
                </div>
            </aside>

        </div>

    </div>

    <!-- Modals -->

    <!-- Confirm Modal -->
    <div x-data="confirmModal"
         x-show="show"
         x-cloak
         class="modal-overlay"
         @click.self="cancel()">
        <div class="modal" @click.away="cancel()">
            <div class="modal-header">
                <h3 x-text="title"></h3>
                <button @click="cancel()" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p x-text="message"></p>
            </div>
            <div class="modal-footer">
                <button @click="cancel()" class="btn btn-secondary">
                    Cancel
                </button>
                <button @click="confirm()" class="btn btn-primary">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- New Project Modal -->
    <div x-data="newProjectModal"
         x-show="show"
         x-cloak
         class="modal-overlay"
         @click.self="close()">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>Create New Project</h3>
                <button @click="close()" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text"
                           x-model="formData.name"
                           placeholder="My Project"
                           class="form-input"
                           @keydown.enter="submit()">
                </div>

                <div class="form-group">
                    <label>Project Type</label>
                    <select x-model="formData.type" class="form-select">
                        <option value="bbox">Bounding Box (Detection)</option>
                        <option value="mask">Segmentation Mask</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Classes</label>
                    <div class="classes-input">
                        <input type="text"
                               x-model="newClassName"
                               placeholder="Class name"
                               class="form-input"
                               @keydown.enter="addClass()">
                        <input type="color"
                               x-model="newClassColor"
                               class="form-color">
                        <button @click="addClass()" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <div class="classes-list-modal">
                        <template x-for="(cls, index) in formData.classes" :key="index">
                            <div class="class-item-modal">
                                <div class="class-color" :style="`background: ${cls.color}`"></div>
                                <span x-text="cls.name"></span>
                                <button @click="removeClass(index)" class="btn-icon-sm btn-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button @click="close()" class="btn btn-secondary">
                    Cancel
                </button>
                <button @click="submit()" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Create Project
                </button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div x-data="exportModal"
         x-show="show"
         x-cloak
         class="modal-overlay"
         @click.self="close()">
        <div class="modal">
            <div class="modal-header">
                <h3>Export Dataset</h3>
                <button @click="close()" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Export Format</label>
                    <select x-model="exportFormat" class="form-select">
                        <option value="yolo">YOLO</option>
                        <option value="coco">COCO JSON</option>
                        <option value="voc">Pascal VOC</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" x-model="includeImages">
                        Include Images
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" x-model="includeLabels">
                        Include Labels
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button @click="close()" class="btn btn-secondary">
                    Cancel
                </button>
                <button @click="startExport()" class="btn btn-primary">
                    <i class="fas fa-download"></i>
                    Export
                </button>
            </div>
        </div>
    </div>

    <!-- Main Script -->
    <script type="module" src="/src/main.js"></script>

</body>
</html>
